{% extends "base.html" %}

{% block content %}
    <script src="{{ url_for('static',filename='echarts.js') }}"></script>

    <div class="jumbotron jumbotron-fluid">
     {#        <div class="warpper">#}
    <div id="menu" class="sidebar textCenter">
    <div style="overflow:hidden;clear:both;">

        <ul class="widget widget-menu short"  style="height:400px;overflow-y:scroll;">
{#            <ul class="widget widget-menu">#}
                <li id="ins_menu"><a href="#togglePage" class="collapsed" data-toggle="collapse"  style="color:white">
                    Select Instrument <i class="fas fa-angle-down pull-right" ></i>
                    {#                        <i class="fas fa-angle-up pull-right"></i>#}
                </a>
                </li>
{#                    <div>#}

                    {% for instrument in all_instruments %}
                        <li class="ins_select"><a
                               href="{{ url_for('core.ins_detail', selected_ins=instrument) }}">{{ instrument }}</a></li>
                        {#                                 <option value={{ instrument }}> {{ instrument }}</option>#}
                    {% endfor %}
{#                    </div>#}

{#            </ul>#}
        </ul>
    </div>
    </div>
        <div class="container full">
            <div id="detailCenter">
                <h1 class="display-4">details</h1>
                <p class="lead">some introduction etc. blah blah blah...</p>
            </div>
            <form method="POST" name="span_form" id="span_form" role="form" action="/detail/{{selected_ins}}">

            <div class="btn-group btn-group-toggle" data-toggle="buttons" style="margin-bottom:13px">
                  <label for="1week" class="btn btn-secondary choice">
                    <input id="1week" type="radio" name="span" value="1week" autocomplete="off"> 1 week
                  </label>
                  <label for="1month" class="btn btn-secondary choice">
                    <input id="1month" type="radio" name="span" value="1month" autocomplete="off"> 1 month
                  </label>
                  <label for="6months" class="btn btn-secondary choice" >
                    <input id="6months" type="radio" name="span" value="6months" autocomplete="off"> 6 months
                  </label>
                  <label for="1year" class="btn btn-secondary choice" >
                    <input id="1year" type="radio" name="span" value="1year" autocomplete="off"> 1 year
                  </label>
                </div>
                </form>
{#            <script>#}
{#                sub() {#}
{##}
{#                }#}
{#            </script>#}

                {#        timepicker   #}

                <form method="POST" name="select_ins" role="form" action="/detail/{{selected_ins}}">
                <div>
                {#			  <form method="post" role="form" action="/detail">#}
                <div style="float:left;text-align: center">
                    <label for="from">from</label>
                    <input type="text" id="fromdate" autocomplete="off" name="start_time">
                    <label for="to">to</label>
                    <input type="text" id="todate" autocomplete="off" name="end_time">

                    <script type="text/javascript">
                        $("#fromdate").datetimepicker({
                            format: "yyyy-mm-dd",
                            autoclose: true,
                            todayBtn: false,
                            pickerPosition: "bottom-left",
                            minView: "month"
                        });

                        $("#todate").datetimepicker({
                            format: "yyyy-mm-dd",
                            autoclose: true,
                            todayBtn: false,
                            pickerPosition: "bottom-left",
                            minView: "month"
                        });
                    </script>
{#                </div>#}
{#                <div style="float:left">#}
                    <button type="submit" class="btn btn-light" style="margin-bottom: 5px; height: 25px; padding-bottom:23px">Search</button>
                    {#			<input type= "hidden" name = "form" value="data">#}
                </div>
                    </div>
            </form>
        </div>



    </div>

    {% if start_time>0 %}
    <div class="container">
    <div id="line" style="width: 625px;height:350px; float:left; margin-left: 20px; margin-top: 40px; padding-left:20px "></div>
    <script type="text/javascript" >
        // 基于准备好的dom，初始化echarts实例

            var myChart = echarts.init(document.getElementById('line'));
            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: 'Instrument \n{{ selected_ins }}',
                    padding: [0,50,50,50],
                },
                tooltip: {
                },
                 toolbox: {
                    feature: {
                        {#dataView: {show: true, readOnly: false},#}
                        restore: {show: true},
                        saveAsImage: {show: true},
                        formatter: function (value, index) {
                            if (value === 1) {
                                var text = "running"
                            }
                            {#else if(value ===0){#}
                            {#    var text = "finish"#}

                            return text
                        }
                    }
                 },
                legend: {
                    data: ['running status']
                },
                dataZoom: [
                    {   // 这个dataZoom组件，默认控制x轴。
                        type: 'slider', // 这个 dataZoom 组件是 slider 型 dataZoom 组件
                        start: 0,      // 左边在 10% 的位置。
                        end: 100         // 右边在 60% 的位置。
                    }
                ],
                xAxis: {
                    type: 'time',
                    axixTick: {
                        show: true,
                    },
                    axisLabel: {

                    },
                    axisPointer: {
                        show: true
                    },

                    {#set min 1 sec advance the start time to make sure the first data absorbed in graph#}
                    {#this is a bug of eCharts#}
                    min: {{ start_time }} - 1000,
                    max: {{ end_time }},
                    dateTimeLabelFormats: {
                        day: '00:00',
                        hour: '%H:00',
                    },
                    axisLine: {

                    },
                    splitNumber: 10,
                    {#minInterval: 3600*1000,#}

                    labels: {
                        rotation: 90,
                        step: 2
                    }
                },
                yAxis: [{
                    max:1.5,
                    {#splitLine:{show: false},#}
                    type: 'value',
                    splitNumber: 3,
                    axisLabel: {
                        show: true,
                        formatter: function (value, index) {
                            if (value === 1) {
                                var text = "running"
                            }
                            return text
                        }
                    }
                }
                      ],
                series: [{
                    name: 'running status',
                    type: 'line',
                    step: 'end',
                    data: {{ ins_data['data'] }},
                    areaStyle: {}

                }]
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option, true);

    console.log({{ ins_data['data'] }})

    </script>

        <div id="pie" style="width: 345px;height:335px;margin-left:0;float: left; margin-top:60px; "></div>
    <script>
        // 绘制图表。
        echarts.init(document.getElementById('pie')).setOption({


            series: {
                type: 'pie',
                radius:'90px',
                data: [
                    {name: 'Uptime', value: {{ins_data['ratio']}}},
                    {name: 'Downtime', value: {{ins_data['rest_ratio']}}},
                    {#{name: 'C', value: 1919}#}
                ],
                label: {
                    show: true,
                    normal: {
                        show: true,
                        position:'outside',
                        formatter: '{b}:\n ({d}%)'
                }
                },
                labelLine:{
                    length:6
                }


            {#toolbox: {#}
            {#        feature: {#}
                        {#dataView: {show: true, readOnly: false},#}
            {#            restore: {show: true},#}
            {#            saveAsImage: {show: true},#}
            {#        }#}
            {#     },#}
        }});
    </script>
</div>

     {% endif %}
</div>
  <script src="{{ url_for('static',filename='select.js') }}"></script>

{% endblock %}

